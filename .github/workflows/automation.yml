
<<<<<<< HEAD
- name: Log results in Google Sheets
  env:
    GOOGLE_SERVICE_ACCOUNT: ${{ secrets.GOOGLE_SERVICE_ACCOUNT }}
    GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}

    PW_STATUS: ${{ job.status }}
    PW_NOTES: "Run finished"
    ARTIFACT_URL: ${{ steps.upload_artifacts.outputs.artifact-url }}

    DEVICE: "desktop"            # or mobile, or read from matrix
    TEST_SUITE: "Full Regression"
    TRAFFIC_SOURCE: "organic"    # or set dynamically
    EVENTS_TRIGGERED: ${{ steps.collect_events.outputs.events }}

  run: node scripts/update-google-sheet.js
=======
name: QA Automation Pipeline

on:
  workflow_dispatch: {}
  schedule:
    - cron: "0 8 * * 1"   # every Monday at 08:00 GMT

jobs:
  e2e-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install Node
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # Install dependencies
      - name: Install dependencies
        run: npm ci

      ############################################################
      # Connect to UK VPN (ExpressVPN CLI)
      ############################################################
      - name: Install ExpressVPN CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y ca-certificates curl
          curl -o expressvpn.deb https://www.expressvpn.works/clients/linux/expressvpn_3.64.0.9-1_amd64.deb
          sudo dpkg -i expressvpn.deb || sudo apt-get install -f -y

      - name: Activate ExpressVPN
        run: |
          echo "${{ secrets.EXPRESSVPN_ACTIVATION_CODE }}" | sudo expressvpn activate
          sudo expressvpn preferences set auto_connect true

      - name: Connect to UK server
        run: sudo expressvpn connect "UK - London"

      ############################################################
      # Run Playwright Tests
      ############################################################
      - name: Install Browsers
        run: npx playwright install --with-deps

      - name: Run tests
        run: |
          npx playwright test --reporter=line

      ############################################################
      # Upload screenshots + videos
      ############################################################
      - name: Upload Playwright Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: playwright-artifacts
          path: |
            test-results/**
            playwright-report/**
          retention-days: 30

      ############################################################
      # Update Google Sheet with results
      ############################################################
      - name: Log results in Google Sheet
        env:
          GOOGLE_SERVICE_ACCOUNT: ${{ secrets.GOOGLE_SERVICE_ACCOUNT }}
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
        run: node ./scripts/update-google-sheet.js
``
>>>>>>> c5f70b50f0a0684a6d96101b06a30537846147fd
